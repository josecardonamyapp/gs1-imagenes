<div class="container-fluid py-4">
  <div class="sticky-header bg-white py-3 px-2 shadow-sm z-index-1000 mb-4">
    <div class="d-flex align-items-center justify-content-between mb-4 gap-3 flex-wrap" style="padding: 5px;">

      <!-- <mat-form-field id="input-gtin" appearance="outline" class="flex-grow-1 w-100" style="max-width: 35%;">
        <mat-label>Buscar por nombre o GTIN</mat-label>
        <input matInput class="small-input" placeholder="Ej: Shampoo o 7500001234567" [(ngModel)]="searchText"
          (ngModelChange)="onSearchChange($event)">
        <button mat-icon-button matSuffix *ngIf="searchText" (click)="clearSearch()" aria-label="Clear">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field> -->

      <mat-form-field id="input-gtin" appearance="outline" class="flex-grow-1 w-100" style="max-width: 50%;">
        <mat-label>Buscar por nombre o GTIN</mat-label>

        <textarea matInput class="small-input" rows="1" placeholder="Ej: Shampoo o 7500001234567,8852369857"
          [(ngModel)]="searchText" (ngModelChange)="onSearchChange($event)">
        </textarea>

        <button mat-icon-button matSuffix *ngIf="searchText" (click)="clearSearch()" aria-label="Clear">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>


      <button id="btn-seleccionar-todos" mat-stroked-button color="primary"
        (click)="selectedGtins.length ? clearAllGtins() : selectAllGtins()">
        {{ selectedGtins.length ? 'Deseleccionar todos' : 'Seleccionar todos' }}
      </button>

      <div class="text-end my-3">
        <button mat-raised-button color="accent" (click)="processSelectedImages()" [disabled]="selectedGtins.length <= 0">Procesar Seleccionadas ({{
          selectedGtins.length }})</button>
      </div>

      <!-- <button id="btn-buscar-gtins" mat-stroked-button color="warn" (click)="openGtinDialog()" style="white-space: nowrap;">
        Buscar por lista de GTINs
      </button> -->

      <!-- <button [tourSteps]="pasos" tourTrigger="click">Iniciar tour</button>

      <div id="paso1">Contenido paso 1</div>
      <div id="paso2">Contenido paso 2</div>

      <button [tourSteps]="pasos" tourTrigger="click">Iniciar tour</button> -->


    </div>
  </div>



  <div class="row g-4">
    @for (product of filtered; track product.gtin) {
    <div id="tarjeta-producto-1" class="col-12 col-sm-6 col-md-3">
      <div class="card product-card  h-100 shadow border-0 rounded-3 bg-white text-start"
        [class.selected-image]="isGtinSelected(product.gtin)"
        (click)="product.images?.length && toggleGtinSelection(product.gtin)"
        [class.no-click]="!product.images?.length">

        <!-- <div class="carousel-counter text-center mb-4"> -->
        <div class="card-header text-center ">
          <span class="badge bg-light text-dark px-2 py-1 rounded">
            <h3>{{ product.images.length > 0 ? 1 : 0 }} / {{ product.images.length }} imágenes</h3>
          </span>
        </div>

        <div class="carousel-container position-relative">
          <button id="carousel-imagenes" mat-icon-button class="carousel-btn left" (click)="previousImage(product)">
            <mat-icon>chevron_left</mat-icon>
          </button>

          <!-- <h3>{{ product.images.length }}</h3> -->
          <!-- <ng-container *ngIf="product.images?.length > 0; else noImage">
            <img [src]="product.images[product.currentIndex]?.uniformresourceidentifier" alt="{{ product.producName }}"
              loading="lazy" class="card-img-top p-3 mx-auto d-block mb-3"
              style="height: 180px; object-fit: contain; border-bottom: 1px solid #eee;" />
          </ng-container> -->
          <ng-container *ngIf="product.images?.length > 0; else noImage">
            <div class="position-relative">
              <img [src]="product.images[product.currentIndex]?.uniformresourceidentifier"
                alt="{{ product.producName }}" loading="lazy" class="card-img-top p-3 mx-auto d-block mb-3"
                style="height: 180px; object-fit: contain; border-bottom: 1px solid #eee;" />
            </div>
          </ng-container>

          <ng-template #noImage>
            <div class="no-image-placeholder d-flex flex-column align-items-center justify-content-center">
              <mat-icon color="warn" fontIcon="image_not_supported" style="font-size: 36px;"></mat-icon>
              <span class="text-muted mt-2" style="font-size: 14px;">Sin imagen</span>
            </div>
          </ng-template>

          <button id="carousel-imagenes" mat-icon-button class="carousel-btn right" (click)="nextImage(product)">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>

        <div class="card-body d-flex flex-column pb-3">
          <div class="mb-1 text-muted" style="font-size: 0.85rem;">
            GTIN: {{ product.gtin }}
          </div>

          <h4 class="card-title fw-semibold text-dark fs-5 mb-3 text-capitalize">
            {{ product.producName }}
          </h4>

          <div id="informacion-tarjeta" class="mt-auto">
            <button mat-button class="custom-orange-button" (click)="goToDetail(product.gtin)">
              <strong class="gs1-subtitles">MÁS INFO</strong>
              <span class="arrow-icon">→</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <div *ngIf="isGenerating" class="loading-overlay">
    <mat-progress-spinner mode="indeterminate" color="primary" diameter="60" strokeWidth="5">
    </mat-progress-spinner>
  </div>
</div>